<div class="page-width page-width--narrow article-template"
     style="
      --title-color: {{ section.settings.title_color }};
      --meta-color: {{ section.settings.meta_color }};
      --body-color: {{ section.settings.body_color }};
      --body-size: {{ section.settings.body_size }}px;
      --article-link-color: {{ section.settings.link_color }};
      --article-link-hover-color: {{ section.settings.link_hover_color }};
      --article-link-bg-hover: {{ section.settings.link_bg_hover }};
     "
>
  <div class="article-template__content">

    <!-- IMAGE -->
    {% if article.image and section.settings.show_image %}
      {% assign img_w = article.image.width %}
      {% assign img_h = article.image.height %}

      <div
        class="article-template__image
          {% if section.settings.image_width == 'full' %}article-template__image--full{% endif %}
        "
        style="
          border-radius: {{ section.settings.image_radius }}px;
          overflow: hidden;
          {% if section.settings.image_height > 0 %}
            aspect-ratio: {{ img_w }} / {{ section.settings.image_height }};
          {% else %}
            aspect-ratio: {{ img_w }} / {{ img_h }};
          {% endif %}
        "
      >
        <img
          src="{{ article.image | img_url: 'master' }}"
          srcset="{{ article.image | img_url: 'master' }} 1x, {{ article.image | image_url: '1024x' }} 2x"
          alt="{{ article.image.alt | escape }}"
          width="{{ img_w }}"
          height="{% if section.settings.image_height > 0 %}{{ section.settings.image_height }}{% else %}{{ img_h }}{% endif %}"
          loading="lazy"
          decoding="async"
          style="width: 100%; height: 100%; object-fit: cover; display: block;"
        >
      </div>
    {% endif %}

    <!-- TITLE + META (Ngày + Tác giả) DƯỚI ẢNH -->
    <div class="article-header">
      {% if section.settings.show_title %}
        <h1 class="article-template__title h1" style="font-size: {{ section.settings.title_size }}px; color: var(--title-color);">
          {{ article.title }}
        </h1>
      {% endif %}

      {% if section.settings.show_meta %}
        <div class="article-meta">
          {{ article.published_at | date: "%d/%m/%Y" }}
          {% if article.author and section.settings.show_author %}
            • {{ article.author }}
          {% endif %}
        </div>
      {% endif %}
    </div>

    <!-- CONTENT -->
    <div class="rte article-template__body">
      {{ article.content }}
    </div>

    <!-- ========== CUSTOM PREV / NEXT ========== -->
    {% if section.settings.show_navigation %}

      {% assign articles = blog.articles %}
      {% assign current_index = -1 %}

      {% for a in articles %}
        {% if a.handle == article.handle %}
          {% assign current_index = forloop.index0 %}
        {% endif %}
      {% endfor %}

      {% assign prev_index = current_index | minus: 1 %}
      {% assign next_index = current_index | plus: 1 %}

      {% if prev_index >= 0 or next_index < articles.size %}
      <div class="article-nav">

        <!-- PREVIOUS -->
        <div class="article-nav__col article-nav__prev">
          {% if prev_index >= 0 %}
            {% assign prev_article = articles[prev_index] %}
            <a href="{{ prev_article.url }}">
              <span class="article-nav__label">← {{ section.settings.prev_label }}</span>
            </a>
          {% endif %}
        </div>

        <!-- CENTER -->
        <div class="article-nav__col article-nav__center">
          <a href="{{ blog.url }}" class="article-nav__blog">
            {{ section.settings.blog_button_text }}
          </a>
        </div>

        <!-- NEXT -->
        <div class="article-nav__col article-nav__next">
          {% if next_index < articles.size %}
            {% assign next_article = articles[next_index] %}
            <a href="{{ next_article.url }}">
              <span class="article-nav__label">{{ section.settings.next_label }} →</span>
            </a>
          {% endif %}
        </div>

      </div>
      {% endif %}
    {% endif %}

  </div>
</div>

<style>
/* LAYOUT */
.page-width--narrow {
  max-width: {{ section.settings.max_width }}px;
  margin: 60px auto;
  padding: 0 20px;
}

/* TITLE + META DƯỚI ẢNH */
.article-header {
  margin-top: 32px; /* Khoảng cách từ ảnh xuống title */
  margin-bottom: 32px;
}

.article-template__title {
  margin: 0 0 8px 0; /* Khoảng cách giữa title và meta */
  color: var(--title-color);
}

.article-meta {
  color: var(--meta-color);
  font-size: 14px;
  white-space: nowrap;
}

/* IMAGE */
.article-template__image {
  margin-bottom: 0; /* Không khoảng cách dưới ảnh vì title ở dưới */
  overflow: hidden;
}

.article-template__image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* FULL WIDTH */
.article-template__image--full {
  width: 100vw;
  margin-left: calc(50% - 50vw);
}

/* CONTENT */
.article-template__body {
  color: var(--body-color);
  font-size: var(--body-size);
  line-height: 1.7;
}

/* NAVIGATION */
.article-nav {
  margin-top: 80px;
  padding-top: 40px;
  border-top: 1px solid #eee;
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 20px;
}

.article-nav__prev { text-align: left; }
.article-nav__next { text-align: right; }
.article-nav__center { text-align: center; }

.article-nav__label {
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  color: {{ section.settings.nav_color }};
}
.article-nav__blog {
  padding: 10px 28px;
  border: 2px solid {{ section.settings.nav_color }};
  border-radius: 999px;
  color: {{ section.settings.nav_color }};
  font-weight: 600;
}

.article-nav__blog:hover {
  background: {{ section.settings.nav_color }};
  color: #fff;
}

/* MOBILE */
@media (max-width: 768px) {
  .article-header {
    margin-top: 24px;
    margin-bottom: 24px;
  }
  .article-nav {
    grid-template-columns: 1fr;
    text-align: center;
  }
}

/* RICH TEXT TYPOGRAPHY */
.article-template__body h1 { font-size: 32px; margin: 48px 0 20px; }
.article-template__body h2 { font-size: 26px; margin: 40px 0 18px; }
.article-template__body h3 { font-size: 22px; margin: 32px 0 16px; }
.article-template__body p { margin: 0 0 18px; }
.article-template__body strong { font-weight: 600; }
.article-template__body blockquote {
  margin: 32px 0;
  padding-left: 20px;
  border-left: 4px solid #e60023;
  font-style: italic;
  color: #555;
}

/* ARTICLE LINKS */
.article-template__body a {
  color: var(--article-link-color);
  text-decoration: underline;
  text-decoration-thickness: 2px;
  text-underline-offset: 4px;
  transition: color 0.2s ease, background-color 0.2s ease;
}

.article-template__body a:hover {
  color: var(--article-link-hover-color);
  background-color: var(--article-link-bg-hover);
}
</style>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const articleBody = document.querySelector('.article-template__body')
    if (!articleBody) return

    articleBody.querySelectorAll('a').forEach(link => {
      link.style.color = getComputedStyle(document.documentElement)
        .getPropertyValue('--article-link-color')
      link.style.textDecoration = 'underline'
    })
  })
</script>

{% schema %}
{
  "name": "Main Article (Custom)",
  "settings": [
    {
      "type": "range",
      "id": "max_width",
      "label": "Chiều rộng nội dung",
      "min": 600,
      "max": 1200,
      "step": 50,
      "default": 800
    },

    /* ===== TITLE & META ===== */
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "Hiển thị tiêu đề bài viết",
      "default": true
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Cỡ chữ tiêu đề (px)",
      "min": 20,
      "max": 48,
      "step": 2,
      "default": 32
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Màu tiêu đề",
      "default": "#111111"
    },
    {
      "type": "checkbox",
      "id": "show_meta",
      "label": "Hiển thị ngày đăng & tác giả",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Hiển thị tác giả",
      "default": true
    },

    /* ===== IMAGE SETTINGS ===== */
    {
      "type": "header",
      "content": "Ảnh bài viết"
    },
    {
      "type": "checkbox",
      "id": "show_image",
      "label": "Hiển thị ảnh bài viết",
      "default": true
    },
    {
      "type": "select",
      "id": "image_width",
      "label": "Chiều rộng ảnh",
      "options": [
        { "value": "content", "label": "Theo chiều rộng nội dung" },
        { "value": "full", "label": "Full chiều ngang màn hình" }
      ],
      "default": "content"
    },
    {
      "type": "range",
      "id": "image_height",
      "label": "Chiều cao ảnh (px)",
      "min": 0,
      "max": 900,
      "step": 20,
      "default": 0,
      "info": "0 = giữ tỷ lệ gốc của ảnh"
    },
    {
      "type": "range",
      "id": "image_radius",
      "label": "Bo góc ảnh",
      "min": 0,
      "max": 40,
      "step": 2,
      "default": 12
    },

    /* ===== TYPOGRAPHY ===== */
    {
      "type": "color",
      "id": "meta_color",
      "label": "Màu meta (ngày & tác giả)",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "body_color",
      "label": "Màu nội dung",
      "default": "#222222"
    },
    {
      "type": "range",
      "id": "body_size",
      "label": "Cỡ chữ nội dung",
      "min": 14,
      "max": 22,
      "default": 16
    },

    /* ===== LINK SETTINGS ===== */
    {
      "type": "color",
      "id": "link_color",
      "label": "Màu link trong nội dung",
      "default": "#e60023"
    },
    {
      "type": "color",
      "id": "link_hover_color",
      "label": "Màu link khi hover",
      "default": "#b8001b"
    },
    {
      "type": "checkbox",
      "id": "link_underline",
      "label": "Gạch chân link",
      "default": true
    },
    {
      "type": "range",
      "id": "link_underline_thickness",
      "label": "Độ dày gạch chân",
      "min": 1,
      "max": 4,
      "default": 2
    },
    {
      "type": "color",
      "id": "link_hover_bg",
      "label": "Nền link khi hover",
      "default": "rgba(230,0,35,0.08)"
    },

    /* ===== NAVIGATION ===== */
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Hiển thị Next / Previous",
      "default": true
    },
    {
      "type": "text",
      "id": "prev_label",
      "label": "Text bài trước",
      "default": "Bài trước"
    },
    {
      "type": "text",
      "id": "next_label",
      "label": "Text bài tiếp theo",
      "default": "Bài tiếp theo"
    },
    {
      "type": "text",
      "id": "blog_button_text",
      "label": "Text nút về blog",
      "default": "Về blog"
    },
    {
      "type": "color",
      "id": "nav_color",
      "label": "Màu navigation",
      "default": "#e60023"
    }
  ]
}
{% endschema %}