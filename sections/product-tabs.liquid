<div class="product-tabs">
  <div class="section_product_collection px-10 md:px-40">
    <div class="section_product py-20">
      <div class="section_product_wapper">
        <div class="section_content tabs_panels">
          <div class="section_header text-center mb-10">
            {% if section.settings.heading %}
              <h2 style="color: {{ section.settings.heading_color }}; font-size: {{ section.settings.heading_size }}px;">
                {{ section.settings.heading }}
              </h2>
            {% endif %}

            {% if section.settings.subheading %}
              <p style="color: {{ section.settings.subheading_color }}; font-size: {{ section.settings.subheading_size }}px;">
                {{ section.settings.subheading }}
              </p>
            {% endif %}
          </div>

          {% if section.blocks.size > 1 %}
            <div class="tabs-navigation flex gap-10 justify-center overflow-x-auto scrollbar-hidden">
              {% for block in section.blocks %}
                <button
                  class="tab-button relative px-5 py-3 text-xl font-medium whitespace-nowrap transition-all duration-300 {% if forloop.first %}active{% endif %}"
                  data-tab-index="{{ forloop.index0 }}">
                  {{ collections[block.settings.collection].title | default: "Collection" }}
                </button>
              {% endfor %}
            </div>
          {% endif %}

          <div class="tabs_panels_collection relative">
            {% for block in section.blocks %}
              <featured-collection
                class="tab-content absolute inset-0 transition-all duration-500 ease-in-out {% unless forloop.first %}opacity-0 -translate-x-10 pointer-events-none{% endunless %}"
                data-tab-index="{{ forloop.index0 }}"
                {{ block.shopify_attributes }}>

                <div class="product-collection-wrapper py-3 flex flex-col items-center">
                  <div class="product-collection flex gap-0 overflow-x-auto scroll-smooth snap-x snap-mandatory scrollbar-hidden">

                    <div class="snap-start flex-shrink-0 w-[240px] baner-card">
                      {% render 'banner-card',
                        image: block.settings.banner_image,
                        show_banner: block.settings.show_banner,
                        title: block.settings.banner_heading,
                        button_label: block.settings.button_label,
                        button_url: block.settings.button_url,
                        content_position: block.settings.content_position,
                        button_style: block.settings.button_style
                      %}
                    </div>

                    <div class="flex gap-0">
                      {% if block.settings.collection != blank %}
                        {% for product in collections[block.settings.collection].products %}
                          <div class="snap-start flex-shrink-0 w-[240px] h-[470px] product-card">
                            {% render 'card-product', product: product %}
                          </div>
                        {% endfor %}
                      {% endif %}
                    </div>

                  </div>

                  <div class="scroll-wrapper mt-4 w-full">
                    {% render 'scroll',
                      prev_action: 'scrollProductsLeft()',
                      next_action: 'scrollProductsRight()'
                    %}
                  </div>
                </div>

              </featured-collection>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* ===== BASIC ===== */
.scrollbar-hidden { scrollbar-width: none; }
.scrollbar-hidden::-webkit-scrollbar { display: none; }

.product-collection {
  width: fit-content;
  max-width: calc(240px + {{ section.settings.products_to_show | default: 4 }} * 240px);
  margin: 0 auto;
  overflow-x: auto;
}

.scroll-wrapper {
  max-width: calc(240px + {{ section.settings.products_to_show | default: 4 }} * 240px);
  margin: 0 auto;
}

/* ===== TAB ===== */
.tab-button { color: #6B7280; }
.tab-button.active,
.tab-button:hover { color: #000; }

/* ===== FIX HEADER OVERLAP ===== */
.product-tabs { position: relative; z-index: 1; }
.product-tabs .tab-content { z-index: 1 !important; }

/* ===== BUTTON HOVER EFFECT ===== */
.btn-slide-hover {
  position: relative;
  overflow: hidden;
  background: transparent;
}

/* gradient */
.btn-slide-hover::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgb(51, 121, 60);
  transform: scaleX(0);
  transform-origin: left;
  transition: transform .4s ease;
  z-index: 0;
}

.btn-slide-hover:hover::before {
  transform: scaleX(1);
}

/* FIX: hover text white */
.btn-slide-hover span,
.btn-slide-hover svg {
  position: relative;
  z-index: 1;
  transition: color .3s ease;
}

.btn-slide-hover:hover span,
.btn-slide-hover:hover svg {
  color: #ffffff !important;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const buttons = document.querySelectorAll('.tab-button');
  const contents = document.querySelectorAll('.tab-content');

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      const index = btn.dataset.tabIndex;
      buttons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      contents.forEach((c, i) => {
        c.classList.toggle('opacity-0', i != index);
        c.classList.toggle('-translate-x-10', i != index);
        c.classList.toggle('pointer-events-none', i != index);
      });
    });
  });
});
</script>

{% schema %}
{
  "name": "Product Tabs",
  "max_blocks": 3,
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Sản phẩm nổi bật" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "Các sản phẩm mới nhất" },
    { "type": "color", "id": "heading_color", "label": "Heading color", "default": "#111827" },
    { "type": "color", "id": "subheading_color", "label": "Subheading color", "default": "#6B7280" },
    { "type": "range", "id": "heading_size", "label": "Heading size", "min": 16, "max": 80, "step": 1, "default": 32 },
    { "type": "range", "id": "subheading_size", "label": "Subheading size", "min": 12, "max": 60, "step": 1, "default": 18 },
    { "type": "range", "id": "products_to_show", "label": "Products to show", "min": 1, "max": 20, "step": 1, "default": 4 }
  ],
  "blocks": [
    {
      "type": "collection_block",
      "name": "Collection",
      "settings": [
        { "type": "collection", "id": "collection", "label": "Collection" },
        { "type": "checkbox", "id": "show_banner", "label": "Show banner", "default": true },
        { "type": "image_picker", "id": "banner_image", "label": "Banner image" },
        { "type": "text", "id": "banner_heading", "label": "Banner heading", "default": "Healthy Lifestyle" },
        { "type": "text", "id": "button_label", "label": "Button label", "default": "Shop Now" },
        { "type": "url", "id": "button_url", "label": "Button link" }
      ]
    }
  ],
  "presets": [{ "name": "Product Tabs Section" }]
}
{% endschema %}
