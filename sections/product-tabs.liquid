<div class="product-tabs">
  <div class="section_product_collection px-10 md:px-40">
    <div class="section_product py-20">
      <div class="section_product_wapper">
        <div class="section_content tabs_panels">
          <div class="tabs_panels_collection">

            {% for block in section.blocks %}
                <featured-collection
                   class="block relative {% if forloop.index > 1 %}hidden{% endif %}"
                   data-collection-block
            {{ block.shopify_attributes }}
            >

                {% if block.settings.collection and forloop.index == 1 %}
                   <div class="flex justify-end mb-3">
                       <button
                         type="button"
                         data-toggle-view
                         class="text-sm font-medium hover:underline"
                       >
                          View all
                        </button>

                    </div>
                 {% endif %}

                <div class="grid grid-flow-col auto-cols-max gap-0 overflow-x-auto scroll-smooth snap-x snap-mandatory product-collection py-3">

                  <!-- Banner card -->
                  <div class="snap-start flex-shrink-0 w-[240px] baner-card m-0 p-0">
                    {% render 'banner-card',
                      image: block.settings.banner_image,
                      title: block.settings.banner_heading,
                      button_label: block.settings.button_label,
                      button_url: block.settings.button_url
                    %}
                  </div>

                  <!-- Product list -->
                  <div class="flex gap-0 f-column">
                    {% if block.settings.collection != blank %}
                      {% for product in collections[block.settings.collection].products
                        limit: block.settings.products_to_show %}
                        <div class="snap-start flex-shrink-0 w-[240px] h-[470px] rounded-none f-column product-card m-0 p-0 border-0 shadow-none bg-transparent">
                          {% render 'card-product', product: product %}
                        </div>
                      {% endfor %}
                    {% else %}
                      <p class="text-center text-gray-500 flex-shrink-0 w-[350px] h-[300px] flex items-center justify-center">
                        Please select a collection.
                      </p>
                    {% endif %}
                  </div>

                </div>

                {% render 'scroll',
                  prev_action: 'scrollProductsLeft()',
                  next_action: 'scrollProductsRight()'
                %}
              </featured-collection>
            {% endfor %}

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Product Tabs",
  "max_blocks": 3,

  "blocks": [
    {
      "type": "collection_block",
      "name": "Collection block",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Select collection"
        },

        {
          "type": "checkbox",
          "id": "show_banner",
          "label": "Show banner",
          "default": true
        },

        {
          "type": "image_picker",
          "id": "banner_image",
          "label": "Banner image"
        },

        {
          "type": "text",
          "id": "banner_heading",
          "label": "Banner heading",
          "default": "Healthy Lifestyle"
        },

        {
          "type": "text",
          "id": "button_label",
          "label": "Button text",
          "default": "Shop Now"
        },

        {
          "type": "url",
          "id": "button_url",
          "label": "Button link"
        },

        {
          "type": "select",
          "id": "content_position",
          "label": "Content position",
          "default": "center",
          "options": [
            { "label": "Top", "value": "top" },
            { "label": "Bottom", "value": "bottom" },
            { "label": "Left", "value": "left" },
            { "label": "Right", "value": "right" },
            { "label": "Center", "value": "center" }
          ]
        },

        {
          "type": "select",
          "id": "button_style",
          "label": "Button style",
          "default": "normal",
          "options": [
            { "label": "Normal", "value": "normal" },
            { "label": "Underline", "value": "underline" },
            { "label": "Hover effect", "value": "hover" }
          ]
        },

        {
          "type": "range",
          "id": "products_to_show",
          "min": 1,
          "max": 20,
          "step": 1,
          "label": "Number of products to show",
          "default": 8
        }
      ]
    }
  ],

  "presets": [
    {
      "name": "Product Tabs Section"
    }
  ]
}
{% endschema %}




<style>
  .product-collection::-webkit-scrollbar {
  display: none; 
}

.product-collection {
  scrollbar-width: none; 
}
/* ===== Scroll buttons hover ===== */
.section_product_collection .btn-slide-hover {
  transition: background-color .25s ease, border-color .25s ease, color .25s ease;
}

.section_product_collection .btn-slide-hover:hover {
  background-color: #000;
  border-color: #000;
}

.section_product_collection .btn-slide-hover:hover svg {
  color: #fff;
}

</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.querySelector('[data-toggle-view]')
    const blocks = document.querySelectorAll('[data-collection-block]')
    let expanded = false

    if (!btn) return

    btn.addEventListener('click', () => {
      expanded = !expanded

      blocks.forEach((block, index) => {
        if (!expanded && index > 0) {
          block.classList.add('hidden')
        } else {
          block.classList.remove('hidden')
        }
      })

      btn.textContent = expanded ? 'View less' : 'View all'
    })
  })
</script>



<script>
document.addEventListener("DOMContentLoaded", function () {

  document.querySelectorAll("featured-collection").forEach(block => {

    const scroller = block.querySelector(".product-collection");
    const thumb = block.querySelector(".scrollThumb");
    const leftBtn = block.querySelector(".scrollLeft");
    const rightBtn = block.querySelector(".scrollRight");

    if (!scroller) return;

    function updateThumb() {
      if (!thumb) return;

      const maxScroll = scroller.scrollWidth - scroller.clientWidth;
      if (maxScroll <= 0) {
        thumb.style.width = "100%";
        return;
      }

      const percent = scroller.scrollLeft / maxScroll;
      thumb.style.width = (percent * 100) + "%";
    }

    leftBtn?.addEventListener("click", () => {
      scroller.scrollBy({ left: -300, behavior: "smooth" });
    });

    rightBtn?.addEventListener("click", () => {
      scroller.scrollBy({ left: 300, behavior: "smooth" });
    });

    scroller.addEventListener("scroll", updateThumb);
    updateThumb();
  });

});
</script>
